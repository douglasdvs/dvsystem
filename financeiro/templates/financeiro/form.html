{% extends 'core/base.html' %}
{% load crispy_forms_tags %}

{% block title %}{{ tipo }}{% endblock %}

{% block content %}
<div class="container py-5">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="f1-title">
            {% if tipo == 'Receita' %}
                <i class="fas fa-arrow-up text-success"></i>
            {% elif tipo == 'Despesa' %}
                <i class="fas fa-arrow-down text-danger"></i>
            {% else %}
                <i class="fas fa-plus"></i>
            {% endif %}
            {{ tipo }} - Cadastro
        </h1>
    </div>

    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card f1-card">
                <div class="card-body">
                    <form method="post" enctype="multipart/form-data">
                        {% csrf_token %}
                        
                        <div class="row">
                            <!-- Informações Básicas -->
                            <div class="col-md-6">
                                <h5 class="mb-3">
                                    <i class="fas fa-info-circle"></i> Informações Básicas
                                </h5>
                                
                                <div class="mb-3">
                                    {{ form.descricao.label_tag }}
                                    {{ form.descricao }}
                                    {% if form.descricao.help_text %}
                                        <small class="form-text text-muted">{{ form.descricao.help_text }}</small>
                                    {% endif %}
                                </div>

                                <div class="row">
                                    <div class="col-6">
                                        <div class="mb-3">
                                            {{ form.data.label_tag }}
                                            {{ form.data }}
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="mb-3">
                                            {{ form.data_vencimento.label_tag }}
                                            {{ form.data_vencimento }}
                                        </div>
                                    </div>
                                </div>

                                <div class="row">
                                    <div class="col-6">
                                        <div class="mb-3">
                                            {{ form.valor.label_tag }}
                                            {{ form.valor }}
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="mb-3">
                                            {{ form.categoria.label_tag }}
                                            {{ form.categoria }}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Informações Adicionais -->
                            <div class="col-md-6">
                                <h5 class="mb-3">
                                    <i class="fas fa-cogs"></i> Informações Adicionais
                                </h5>

                                {% if form.cliente %}
                                <div class="mb-3">
                                    {{ form.cliente.label_tag }}
                                    {{ form.cliente }}
                                </div>
                                {% endif %}

                                {% if form.pedido %}
                                <div class="mb-3">
                                    {{ form.pedido.label_tag }}
                                    {{ form.pedido }}
                                </div>
                                {% endif %}

                                {% if form.centro_custo %}
                                <div class="mb-3">
                                    {{ form.centro_custo.label_tag }}
                                    {{ form.centro_custo }}
                                </div>
                                {% endif %}

                                <div class="row">
                                    <div class="col-6">
                                        <div class="mb-3">
                                            {{ form.forma_pagamento.label_tag }}
                                            {{ form.forma_pagamento }}
                                        </div>
                                    </div>
                                    <div class="col-6">
                                        <div class="mb-3">
                                            {{ form.status.label_tag }}
                                            {{ form.status }}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Observações e Anexo -->
                        <div class="row">
                            <div class="col-md-8">
                                <div class="mb-3">
                                    {{ form.observacoes.label_tag }}
                                    {{ form.observacoes }}
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    {{ form.anexo.label_tag }}
                                    {{ form.anexo }}
                                    <small class="form-text text-muted">
                                        Formatos aceitos: JPG, PNG, PDF (máx. 2MB)
                                    </small>
                                </div>
                            </div>
                        </div>

                        <!-- Exibir erros do formulário -->
                        {% if form.errors %}
                        <div class="alert alert-danger">
                            <h6><i class="fas fa-exclamation-triangle"></i> Erros encontrados:</h6>
                            {{ form.errors }}
                        </div>
                        {% endif %}

                        <!-- Botões -->
                        <div class="d-flex justify-content-between mt-4">
                            <a href="{% url 'financeiro:listar' %}" class="btn btn-outline-secondary">
                                <i class="fas fa-times"></i> Cancelar
                            </a>
                            <button type="submit" class="btn f1-btn">
                                <i class="fas fa-save"></i> Salvar {{ tipo }}
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Scripts para melhorar UX -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Auto-preencher data de vencimento baseada na data
    const dataField = document.querySelector('input[name="data"]');
    const vencimentoField = document.querySelector('input[name="data_vencimento"]');
    
    if (dataField && vencimentoField && !vencimentoField.value) {
        dataField.addEventListener('change', function() {
            if (this.value && !vencimentoField.value) {
                vencimentoField.value = this.value;
            }
        });
    }

    // Formatar valor monetário
    const valorField = document.querySelector('input[name="valor"]');
    if (valorField) {
        valorField.addEventListener('input', function() {
            let value = this.value.replace(/[^\d,]/g, '');
            if (value.includes(',')) {
                const parts = value.split(',');
                if (parts[1] && parts[1].length > 2) {
                    parts[1] = parts[1].substring(0, 2);
                    value = parts.join(',');
                }
            }
            this.value = value;
        });
    }
});
</script>
{% endblock %}